# Stage 1: build base image with prequisite packages
FROM arm32v7/ubuntu:xenial
LABEL maintainer="tuanlm@greenglobal.vn"

# Enable QEMU for ARM to build ARM image on X86 machine
COPY ./qemu-arm-static /usr/bin/qemu-arm-static

# http://bugs.python.org/issue19846
# > At the moment, setting "LANG=C" on a Linux system *fundamentally breaks Python 3*, and that's not OK.
ENV LANG C.UTF-8

# Set timezone
ENV TIMEZONE Asia/Tokyo
RUN echo ZONE="$TIMEZONE" > /etc/default/clock && cp "/usr/share/zoneinfo/$TIMEZONE" /etc/localtime

# Install necessary packages for the installer
RUN apt-get update -y && \
    apt-get dist-upgrade -y && \
    apt-get autoremove -y
RUN apt-get install update-manager-core -y

RUN apt-get install --fix-missing -y \
    apt-utils \
    lsb-release \
    build-essential \
    sed \
    sudo \
    tar \
    udev \
    wget \
    libusb-1.0-0-dev \
    python-dev \
    python3-dev \
    libatlas-base-dev \
    libopenblas-dev \
    apt-transport-https \
    usbutils

# Fix debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used)
# https://nesterof.com/blog/2017/09/21/debconf-no-usable-dialog-like-program-is-installed-so-the-dialog-based-frontend-cannot-be-used/
# RUN sudo apt-get install dialog whiptail -y

# Run the installer
COPY pip.conf /etc/pip.conf
# RUN pip install --upgrade pip
# RUN pip install virtualenv virtualenv-tools
RUN wget https://bootstrap.pypa.io/get-pip.py
RUN python2 get-pip.py && \
    python3 get-pip.py

# Do clean jobs
RUN sudo apt-get clean && sudo apt-get autoremove